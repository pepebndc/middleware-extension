<!DOCTYPE html>
<html>
<head>
    <title>Fee Injection Test</title>
    <style>
        body { font-family: monospace; margin: 20px; }
        .test { border: 1px solid #ccc; margin: 10px 0; padding: 10px; }
        .success { background: #d4edda; }
        .error { background: #f8d7da; }
        .info { background: #d1ecf1; }
        button { margin: 5px; padding: 10px; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 5px; overflow-x: auto; }
        .log { max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>üß™ Uniswap Fee Injection Test</h1>
    
    <div class="test info">
        <h3>Test Status</h3>
        <div id="status">üîÑ Loading extension...</div>
    </div>
    
    <div class="test">
        <h3>üîß Test Controls</h3>
        <button onclick="testFeeInjection()">Test Fee Injection</button>
        <button onclick="simulateSwap()">Simulate ETH‚ÜíUSDT Swap</button>
        <button onclick="clearLogs()">Clear Logs</button>
    </div>
    
    <div class="test">
        <h3>üìä Transaction Details</h3>
        <div>
            <strong>Target Router:</strong> <span id="router">0x66a9893cc07d91d95644aedd05d03f95e1dba8af</span><br>
            <strong>Function Signature:</strong> <span id="function">0x3593564c</span><br>
            <strong>Fee Recipient:</strong> <span id="recipient">0x237D4cfE852DB65d6b170f4F9BDcB09acA2375Ed</span><br>
            <strong>Fee Rate:</strong> <span id="rate">1%</span>
        </div>
    </div>
    
    <div class="test">
        <h3>üìù Console Logs</h3>
        <div id="logs" class="log">
            <div style="color: #666;">Logs will appear here...</div>
        </div>
    </div>
    
    <div class="test">
        <h3>üîç Last Transaction</h3>
        <pre id="transaction">No transaction yet</pre>
    </div>

    <script>
        // Override console.log to capture logs
        const originalLog = console.log;
        const logs = [];
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            const timestamp = new Date().toLocaleTimeString();
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg) : String(arg)
            ).join(' ');
            logs.push(`[${timestamp}] ${message}`);
            updateLogDisplay();
        };
        
        function updateLogDisplay() {
            const logsDiv = document.getElementById('logs');
            logsDiv.innerHTML = logs.slice(-50).map(log => `<div>${log}</div>`).join('');
            logsDiv.scrollTop = logsDiv.scrollHeight;
        }
        
        function clearLogs() {
            logs.length = 0;
            updateLogDisplay();
        }
        
        // Check if extension is loaded
        setTimeout(() => {
            const status = document.getElementById('status');
            if (window.ethereum && window.ethereum.request) {
                const funcString = window.ethereum.request.toString();
                if (funcString.includes('ETHEREUM REQUEST INTERCEPTED')) {
                    status.innerHTML = '‚úÖ Extension loaded and active';
                    status.parentElement.className = 'test success';
                } else {
                    status.innerHTML = '‚ö†Ô∏è Extension not detected';
                    status.parentElement.className = 'test error';
                }
            } else {
                status.innerHTML = '‚ùå No ethereum provider found';
                status.parentElement.className = 'test error';
            }
        }, 1000);
        
        // Test fee injection
        async function testFeeInjection() {
            console.log('üß™ Starting fee injection test...');
            
            if (!window.ethereum) {
                console.log('‚ùå No ethereum provider');
                return;
            }
            
            try {
                const testTx = {
                    to: '0x66a9893cc07d91d95644aedd05d03f95e1dba8af',
                    data: '0x3593564c0000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000001600000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000011f20d756ede4d000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000420c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2000bb8dac17f958d2ee523a2206206994597c13d831ec7000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000',
                    value: '0x11f20d756ede4d'
                };
                
                console.log('üì§ Sending test transaction:', testTx);
                
                const result = await window.ethereum.request({
                    method: 'eth_sendTransaction',
                    params: [testTx]
                });
                
                console.log('üì• Transaction result:', result);
                document.getElementById('transaction').textContent = JSON.stringify(result, null, 2);
                
            } catch (error) {
                console.error('‚ùå Test failed:', error);
                document.getElementById('transaction').textContent = `Error: ${error.message}`;
            }
        }
        
        // Simulate a real swap
        async function simulateSwap() {
            console.log('üîÑ Simulating ETH ‚Üí USDT swap...');
            
            if (!window.ethereum) {
                console.log('‚ùå No ethereum provider');
                return;
            }
            
            try {
                // Simulate the actual transaction from the user's logs
                const swapTx = {
                    to: '0x66a9893cc07d91d95644aedd05d03f95e1dba8af',
                    data: '0x3593564c0000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000001600000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000004200e8b3d0dac17f958d2ee523a2206206994597c13d831ec7000bb8c02aaa39b223fe8d0a0e5c4f27ead9083c756cc20000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000',
                    value: '0x10000000000000000' // 0.07 ETH
                };
                
                console.log('üí∞ Swapping 0.07 ETH for USDT with fee injection');
                console.log('üì§ Original transaction:', swapTx);
                
                const result = await window.ethereum.request({
                    method: 'eth_sendTransaction',
                    params: [swapTx]
                });
                
                console.log('üì• Final transaction result:', result);
                document.getElementById('transaction').textContent = JSON.stringify({
                    original: swapTx,
                    result: result
                }, null, 2);
                
            } catch (error) {
                console.error('‚ùå Swap simulation failed:', error);
                document.getElementById('transaction').textContent = `Error: ${error.message}`;
            }
        }
        
        console.log('üî• Fee injection test page loaded');
    </script>
</body>
</html> 